generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "darwin-arm64", "darwin", "windows", "linux-musl-openssl-3.0.x", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Conversation {
  id        String    @id @default(cuid())
  title     String
  pinned    Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  messages  Message[]
  images    Image[]
}

model Image {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sequenceNum    Int          // Auto-incrementing per conversation (1, 2, 3...)
  filename       String       // UUID.ext on filesystem
  mimeType       String
  source         String       // 'upload' | 'screenshot' | 'viewImage'
  sourceUrl      String?      // For screenshots (page URL)
  sourceName     String?      // For uploads (original filename)
  description    String?      // Cached description
  createdAt      DateTime     @default(now())

  @@unique([conversationId, sequenceNum])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  role           String       // "user", "assistant", "system"
  content        String       // Main text
  thinking       String?      // Reasoning/thinking content
  toolCalls      ToolCall[]
  createdAt      DateTime     @default(now())
}

model ToolCall {
  id        String   @id @default(cuid())
  messageId String
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  toolName  String
  input     String   // JSON
  output    String?  // JSON
  status    String   // "pending", "success", "error"
  createdAt DateTime @default(now())
}

model Skill {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  content     String   // SKILL.md content
  sourceUrl   String?  // skillregistry.io URL
  enabled     Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Permission {
  id        String   @id @default(cuid())
  path      String
  operation String   // "read", "write", "execute"
  scope     String   // "session", "always"
  createdAt DateTime @default(now())

  @@unique([path, operation])
}

model Settings {
  id                 String   @id @default("default")
  theme              String   @default("system")
  defaultModel       String   @default("anthropic/claude-sonnet-4")
  analyticsOptIn     Boolean?
  onboardingComplete Boolean  @default(false)
  preferredBrowser   String?  // "chrome", "arc", "edge", "brave", etc.
  browserHeadless    Boolean  @default(true) // Run browser in headless mode by default
  updatedAt          DateTime @updatedAt
}
